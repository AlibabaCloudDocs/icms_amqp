# 监控报警 {#concept_101723_zh .concept}

消息队列 AMQP 提供的报警功能，是根据您配置的一些报警规则，基于接入的后台云监控所采集到的数据，来分析和判断某些资源（Vhost 或 Queue）的使用是否超过配置的阈值。如果已超过，则通过短信、邮件、旺旺和钉钉机器人等方式通知给相应的联系人。您可以利用此功能提醒您及时处理问题或升级规格。

**说明：** 如需接收短信通知，您需登录[云监控控制台](https://cloudmonitor.console.aliyun.com/#/home/ecs)，在概览页单击**购买短信**，购买相应的短信服务。

目前针对各资源类型提供的监控项如下：

-   **Vhost 的监控项：** 
    -   实例消息生产数量（count/min）
    -   实例消息消费数量（count/min）
-   **Queue 的监控项：** 
    -   Queue 消息生产数量（count/min）
    -   Queue 消息消费数量（count/min）
    -   Queue 消息堆积数量（条数）

## 授予云资源访问权限 {#section_iwj_hb1_zbf .section}

消息队列 AMQP 接入了后台云监控，首次使用监控报警功能时，消息队列 AMQP 需要您的阿里云主账号授权，才能访问您包括云监控在内的云资源。主账号授权后，消息队列 AMQP 也可以访问该主账号下的 [RAM 用户](../../../../cn.zh-CN/产品简介/基本概念.md#section_ty7_tyy_31d)（子账号）的云资源。

**前提条件**

您尚未使用过消息队列 AMQP 的监控报警功能。

**操作步骤**

1.  登录[消息队列 AMQP 控制台](https://amqp.console.aliyun.com)。在左侧导航栏，单击**监控报警**。

    页面跳转至云资源访问授权页面。

2.  在云资源访问授权页面，单击**同意授权**。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/1095291/156453823053936_zh-CN.png)


成功授权后，即可开始使用该功能。

## 查看监控数据 {#section_h2c_epb_hqf .section}

无论您是否设置了报警，您都可以在消息队列 AMQP 控制台查看资源监控项的数据统计。

**前提条件**

请确保已做好以下准备：

-   创建了 Vhost、Exchange 和 Queue。详情请参见[../../../../dita-oss-bucket/SP\_603/DNICMS19101809/ZH-CN\_TP\_1095283.md\#](../../../../cn.zh-CN/.md#)。

-   创建的 Exchange 和 Queue 已经绑定。详情请参见[../../../../dita-oss-bucket/SP\_603/DNICMS19101809/ZH-CN\_TP\_1095284.md\#](../../../../cn.zh-CN/.md#)。


**操作步骤**

1.  登录[消息队列 AMQP 控制台](https://amqp.console.aliyun.com)。在顶部导航栏，选择要查看监控数据的资源所在地域（Region），例如**华东1（杭州）**。

2.  在左侧导航栏，单击**监控报警**。在监控报警页面选择需要查看监控数据的资源：

    -   如需查看 Vhost 的报警信息，请直接单击 **Vhost** 页签；

    -   如需查看 Queue 的报警信息，请先在页面上方选择 Queue 所在的 Vhost，再单击 **Queue** 页签。

3.  找到要查看的资源，在其所在行的**操作**列中，单击**查看监控** 。

    您可以选择查看最近 1 小时、3 小时、6 小时、12 小时、1 天、3 天、7 天或 14 天的数据，也可以单击最右端的时间选择框，自定义要查看的时间段。

    若您要自定义时间段，最长能查看最近 31 天的数据（超过 31 天的数据不保留），即时间选择框中的**结束时间**为当前系统时间，而**开始时间**最早可为 31 天前。若**结束时间**不是当前系统时间，则可查看 31 天内最长任意 7 天的数据。

    **说明：** 监控项的数据聚合周期为 1 分钟。


## 设置报警 {#section_6j7_wge_glh .section}

您可以通过创建报警规则及时接收异常情况的通知。

**前提条件**

请确保已做好以下准备：

-   创建了 Vhost、Exchange 和 Queue。详情请参见[../../../../dita-oss-bucket/SP\_603/DNICMS19101809/ZH-CN\_TP\_1095283.md\#](../../../../cn.zh-CN/.md#)。

-   创建的 Exchange 和 Queue 已经绑定。详情请参见[../../../../dita-oss-bucket/SP\_603/DNICMS19101809/ZH-CN\_TP\_1095284.md\#](../../../../cn.zh-CN/.md#)。


**操作步骤**

1.  登录[消息队列 AMQP 控制台](https://amqp.console.aliyun.com)。在顶部导航栏，选择要查看监控数据的资源所在地域（Region），例如**华东1（杭州）**。

2.  在左侧导航栏，单击**监控报警**。在监控报警页面选择需要设置报警的资源：

    -   如需查看 Vhost 的报警信息，请直接单击 **Vhost** 页签；

    -   如需查看 Queue 的报警信息，请先在页面上方选择 Queue 所在的 Vhost，再单击 **Queue** 页签。

3.  找到要设置报警的资源，在其所在行的**操作**列中，单击**设置报警** 。

4.  在创建报警规则页面，设置报警规则和通知方式，详情请参见[报警服务](../../../../cn.zh-CN/快速入门/报警服务.md#)。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/1095291/156453823053937_zh-CN.png)


**说明：** 

-   系统不支持跨 Vhost 的批量报警设置。

-   设置具体规则时，请尽量避免使用 “between” 和多表达式。

-   云监控的免费报警规则额度是 50 个，若超过此数量则需要升级云监控服务，详情请参见[变配说明](../../../../cn.zh-CN/产品定价/变配说明.md#)。

-   如需接收短信通知，请登录[云监控控制台](https://cloudmonitor.console.aliyun.com/#/home/ecs)，在概览页单击**购买短信**，购买相应的短信服务。


## 查看报警信息 {#section_3yf_pax_luk .section}

您可以在消息队列 AMQP 控制台或者跳转到云监控的控制台查看已创建的报警规则和相应的报警信息。

**前提条件**

请确保已做好以下准备：

-   创建了 Vhost、Exchange 和 Queue。详情请参见[../../../../dita-oss-bucket/SP\_603/DNICMS19101809/ZH-CN\_TP\_1095283.md\#](../../../../cn.zh-CN/.md#)。

-   创建的 Exchange 和 Queue 已经绑定。详情请参见[../../../../dita-oss-bucket/SP\_603/DNICMS19101809/ZH-CN\_TP\_1095284.md\#](../../../../cn.zh-CN/.md#)。

-   您已经创建了报警规则。详情请参见[设置报警](#section_6j7_wge_glh)。


**操作步骤**

1.  登录[消息队列 AMQP 控制台](https://amqp.console.aliyun.com)。在顶部导航栏，选择要查看报警信息的资源所在地域，例如**华东1（杭州）**。
2.  在左侧导航栏，单击**监控报警**。在监控报警页面选择需要查看报警信息的资源：

    -   如需查看 Vhost 的报警信息，请直接单击 **Vhost** 页签；

    -   如需查看 Queue 的报警信息，请先在页面上方选择 Queue 所在的 Vhost，再单击 **Queue** 页签。

3.  在监控报警页面，可选择以下任一方式查看报警详情信息：

    -   单击**查看报警信息**按钮。

        页面跳转到云监控控制台的报警规则列表页面，默认显示所有消息队列 AMQP 的报警规则和其状态。您可以查看、修改、禁用（或启用）和删除报警规则。

    -   单击任一资源的**报警项情况**列中的**报警项数：X个**（“X” 为您为该资源所设置的报警规则数）。

        在打开的报警项情况窗口中，查看该资源的所有报警规则和相应的报警信息。单击某报警规则的**操作**列中的**查看**，页面会跳转到云监控控制台的报警规则详情页，供您查看关于该报警规则的所有信息，以及对其进行修改、禁用（或启用）和删除等操作。


